machine:
  environment:
    CRASHLYTICS_API_KEY: 4cdb005d0ddfebc8865c0a768de9b43c993e9113
    CRASHLYTICS_BUILD_SECRET: 83001519164842a323e4d70c5970b041c248835fec59db59b409f5b364e47f72
    CRASHLYTICS_FRAMEWORK_PATH: Pods/CrashlyticsFramework/Crashlytics.framework

dependencies:
  pre:
    - ./scripts/import_credentials.sh
    - sudo gem install cocoapods -v 0.36.0.beta.2
    - sudo gem install cupertino shenzhen

  cache_directories:
    - "Pods"

test:
  override:
    - >
      ./scripts/env.sh && 
      ipa build -t --xcconfig Configs/Dev.xcconfig \
                   --xcargs BUNDLE_BUILD=$BN \
                   --ipa products/${BN}.ipa

deployment:
  master:
    branch: master
    commands:
      - >
        ./scripts/env.sh &&
        ipa distribute:crashlytics -f products/${BN}.ipa \
                                   -g team \
                                   -a $CRASHLYTICS_API_KEY \
                                   -s $CRASHLYTICS_BUILD_SECRET

general:
  artifacts:
    - products