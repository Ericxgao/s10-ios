machine:
  xcode:
    version: "7.1"

dependencies:
  override:
  pre:
    - brew update
    - brew install node
    - sudo gem update fastlane gym
    - sudo gem install cocoapods -v $(var=$(tail -1 ios/Podfile.lock); echo ${var##COCOAPODS:})
  override:
    - npm install
    - npm install -g react-native-cli # Technically should use the one installed above, but temp workaround
    - fastlane pod_install
  post:
    - fastlane import_certs
  cache_directories:
    - "node_modules"
    - "ios/Pods"

test:
  override:
    - fastlane test

deployment:
  master:
    branch: master
    commands:
      - fastlane deploy_master

  prod:
    branch: prod
    commands:
     - fastlane deploy_prod

  other:
    branch: /.*/
    commands:
     - fastlane deploy_other
