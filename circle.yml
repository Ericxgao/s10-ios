machine:
  xcode:
    version: "7.1"
  environment:
    # Avoid Circle having to infer itself
    XCODE_WORKSPACE: ios/Taylr.xcworkspace 
    XCODE_SCHEME: Taylr

dependencies:
  override:
  pre:
    - brew update
    - brew install node
    - sudo gem install cocoapods -v $(var=$(tail -1 ios/Podfile.lock); echo ${var##COCOAPODS:})
    - sudo gem update gym
  override:
    - npm install
    - fastlane pod_install
  post:
    - npm install -g react-native-cli # Technically should use the one installed above, but temp workaround
    - fastlane import_certs
  cache_directories:
    - "node_modules"
    - "ios/Pods"

test:
  override:
    - fastlane test

deployment:
  master:
    branch: master
    commands:
      - fastlane deploy_master

  prod:
    branch: prod
    commands:
     - fastlane deploy_prod
